"use strict";angular.module("well",["ngRoute","well.controllers","well.filters","well.services","well.directives","well.survey","well.tradeoff","well.overlap","well.results"]).config(["$routeProvider","$locationProvider",function(e){e.when("/",{templateUrl:"landing.html"}).when("/auth",{templateUrl:"auth.html"}).when("/consent",{templateUrl:"consent.html"}).when("/terms",{templateUrl:"terms.html"}).when("/privacy",{templateUrl:"privacy.html"}).when("/threetwo/survey",{templateUrl:"survey.html",controller:"SurveyCtrl"}).when("/threetwo/abbcca",{templateUrl:"tradeoff.html",controller:"ThreeCtrl"}).when("/threetwo/dbec",{templateUrl:"tradeoff.html",controller:"TwoCtrl"}).when("/threetwo/exit",{templateUrl:"exit.html",controller:"ExitCtrl"}).when("/overlap/survey",{templateUrl:"survey.html",controller:"SurveyCtrl"}).when("/overlap/abac",{templateUrl:"tradeoff.html",controller:"AbacCtrl"}).when("/overlap/abc",{templateUrl:"overlap.html",controller:"AbcCtrl"}).when("/overlap/exit",{templateUrl:"exit.html",controller:"ExitCtrl"}).when("/fineoverlap/survey",{templateUrl:"survey.html",controller:"SurveyCtrl"}).when("/fineoverlap/tradeoff",{templateUrl:"fineoverlap.html",controller:"FineCtrl"}).when("/fineoverlap/exit",{templateUrl:"exit.html",controller:"ExitCtrl"}).when("/chart",{templateUrl:"chart.html",controller:"ChartCtrl"}).when("/dummy",{templateUrl:"dummy.html",controller:"DummyCtrl"}).otherwise({redirectTo:"/"})}]);
"use strict";angular.module("well.controllers",[]).controller("AppCtrl",["$scope","$rootScope","$timeout","User","$location","Aspects","Survey",function(n,e,o,s,i,l,a){n.aspects={texts:l.texts},e.$on("auth",function(){l.names().then(function(e){return n.aspects.names=e})}),a.getResponses(),n.responses=a.responses,n.user=s,n.settings={devmode:!1},n.landing={url:"preamble.html"},n.loc=i,n.login={wrong:!1,placeholder:{email:"Enter your email",password:"Password"},submit:function(){n.login.email?n.login.password?s.login(this.email,this.password).then(function(e){n.login.wrong="in",console.log("Logged in as: ",e.uid),n.landing.url="modules.html"},function(e){n.login.wrong=e.code,"INVALID_EMAIL"===e.code?(n.login.email="",n.login.placeholder.email="Enter a valid email"):"INVALID_PASSWORD"===e.code&&(n.login.password="",n.login.placeholder.password="Enter a valid password"),console.error("Login failed: ",e)}):(n.login.wrong="INVALID_PASSWORD",n.login.placeholder.email="Enter a valid password"):(n.login.wrong="INVALID_EMAIL",n.login.placeholder.email="Enter a valid email")}},n.signup={wrong:!1,placeholder:{email:"Enter your email",password:"Password",confirm:"Confirm password"},submit:function(){if(n.signup.email)if(n.signup.password)if(n.signup.password&&n.signup.password&&n.signup.password!==n.signup.confirm)n.signup.wrong="mismatch",n.signup.confirm="";else{s.signup(n.signup.email,n.signup.password).then(function(){o(function(){return n.landing.url="terms.html"})},function(e){console.log(e),n.signup.wrong=e.code,"INVALID_EMAIL"===e.code?(n.signup.email="",n.signup.placeholder.email="Enter a valid email"):"INVALID_PASSWORD"===e.code?(n.signup.password="",n.signup.placeholder.password="Enter a valid password"):"EMAIL_TAKEN"===e.code&&(n.signup.false=!0,alert("The specified email address is already in use.")),console.error("Sign up failed: ",e)})}else n.signup.wrong="INVALID_PASSWORD",n.signup.placeholder.email="Enter a valid password";else n.signup.wrong="INVALID_EMAIL",n.signup.placeholder.email="Enter a valid email"},agree:function(){s.login(n.signup.email,n.signup.password).then(function(e){n.login.wrong="in",console.log("Logged in as: ",e.uid),n.landing.url="modules.html"},function(n){console.log(n)})}}}]).controller("DummyCtrl",["$scope",function(n){var e=["Following your passion","Being acknowledged for your work","Being treated fairly","Having meaningful relationships","Having a sense of purpose"];n.pairs=_.map(e,function(n,o){return[n,e[(o+1)%5]]}),n.levels={},_.each(e,function(e){n.levels[e]=Math.round(35*Math.random()+60)}),n.selections={},console.log(n.pairs,n.levels)}]);
"use strict";angular.module("well.directives",[]).directive("earth",["$window","Aspects",function(e){return{restrict:"EA",scope:{},link:function(t){window.onresize=function(){t.$apply()},t.$watch(function(){return angular.element(e)[0].innerWidth},function(){t.render()});var n=d3.select(".splash");t.render=function(){n.selectAll(".earth *").remove();{var e=window.innerWidth,r=window.innerHeight,i=d3.geo.orthographic().precision(0).scale(500).translate([e/2,r/2]).clipAngle(180),l=d3.select(".splash .earth").append("canvas").attr("width",e).attr("height",r),o=l.node().getContext("2d"),a=d3.geo.path().projection(i).context(o);d3.random.logNormal(1)}_.each(t.responses,function(e){e.rand=20*Math.random()+10}),d3.json("world-110m.json",function(t,n){function l(){i.rotate([.1*d,.1*c,30]),o.clearRect(0,0,e,r),_.each(s,function(e){o.beginPath(),o.strokeStyle=d3.hsl(e.properties.color*d,1,.8).toString(),a(e),o.stroke()})}var d,c=0;window.onscroll=function(){c=(window.pageYOffset||document.scrollTop)-(document.clientTop||0)||0,l()},d3.select("body").on("mousemove",function(){d=d3.mouse(this)[0],l()});var s=(topojson.feature(n,n.objects.land),topojson.feature(n,n.objects.countries).features);_.each(s,function(e){e.properties.color=Math.random()}),l()})}}}}]).directive("range",["$window","$timeout","Aspects",function(e,t){return{restrict:"EA",scope:{level:"="},link:function(n,r){var i=d3.select(r[0]).append("svg").style("width","100%").style("height",22);window.onresize=function(){n.$apply()},n.$watch(function(){return angular.element(e)[0].innerWidth},function(){n.render()});var l=null;n.$watch("level",function(e){e!==l&&n.render()}),n.render=function(){function e(){var e=c.extent()[0],r=d.invert(d3.mouse(this)[0]);e=isNaN(r)?e:r,c.extent([e,e]),e&&(e=Math.round(e)),v.style("display","block").attr("d",h(p().set(d(e)))+"Z"),l=e,t(function(){n.level=e})}i.selectAll("*").remove();var o=d3.select(r[0])[0][0].offsetWidth,a=22,d=d3.scale.linear().domain([0,100]).range([6,o-6]).clamp(!0),c=d3.svg.brush().x(d).extent([n.level,n.level]).on("brush",e),s=i.append("g").attr("class","axis");s.call(d3.svg.axis().scale(d).orient("bottom").tickSize(0).tickValues([]));var u=s.select(".domain").attr("transform","translate(0, 10)");u.select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");var f=i.append("g").attr("class","slider").call(c);f.selectAll(".extent,.resize").remove(),f.select(".background").attr("height",a);var p=function(){var e=d(1),t=10;return{set:function(n){return e=n,[{x:e-6,y:t-6},{x:e+6,y:t-6},{x:e+6,y:t+6},{x:e,y:t+10},{x:e-6,y:t+6}]}}},h=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),v=f.append("path").attr("class","handle").attr("d",h(p().set(d(n.level)))+"Z").style("display","none")}}}}]).directive("bar",["$window","Aspects","$filter",function(e,t,n){return{restrict:"E",scope:{level:"=",diff:"=",name:"=",choice:"="},link:function(r,i){var l=d3.select(i[0]).append("svg").style("width","100%").style("height",40);window.onresize=function(){r.$apply()},r.$watch("level",function(){r.render()}),r.$watch("diff",function(){r.render()}),r.$watch("name",function(){r.render()}),r.$watch("choice",function(){r.render()},!0),r.$watch(function(){return angular.element(e)[0].innerWidth},function(){r.render()}),r.render=function(){l.selectAll("*").remove();var e=d3.select(i[0])[0][0].offsetWidth,o=e>0?e:100,a=40,d=d3.scale.linear().domain([0,100]).range([6,o-6]),c=l.append("g").attr("class","axis").attr("transform","translate(0,"+(a-20)+")");c.call(d3.svg.axis().scale(d).orient("bottom").tickSize(0).tickPadding(12)),c.select(".domain").remove();var s=(l.append("rect").attr("x",d(0)).attr("y",4).attr("height",20).attr("width",d(100)-d(0)).style("fill",t.getColor(r.name,-1)),l.append("rect").attr("x",d(0)).attr("y",4).attr("height",20).attr("width",d(r.level)-d(0)).style("fill",t.getColor(r.name,100)),l.append("rect").attr("x",d(0)).attr("y",4).attr("height",20).attr("width",0).style("fill",t.getColor(r.name,205))),u=function(e,t){return"M"+d(e)+" 3 L"+Number(d(t)-4)+" 3L"+Number(d(t)-4)+" 1 L"+d(t)+" 4L"+Number(d(t)-4)+" 7L"+Number(d(t)-4)+" 5L"+d(e)+" 5 Z"},f=function(e,t){return"M"+d(e)+" 3 L"+Number(d(t)+4)+" 3L"+Number(d(t)+4)+" 1 L"+d(t)+" 4L"+Number(d(t)+4)+" 7L"+Number(d(t)+4)+" 5L"+d(e)+" 5 Z"},p=l.append("path").attr("stroke","none").style("fill","#000"),h=l.append("text").attr("y",14).attr("dy",".375em").style("fill","#000").style("font-weight","400");if(r.diff>0){var v=d(r.diff)-d(0);s.attr("x",d(r.level)).transition().delay(300).duration(1e3).attr("width",v),p.attr("d",u(r.level,r.level)).transition().delay(300).duration(1e3).attr("d",u(r.level,r.level+r.diff)),h.text("+"+n("round1")(r.diff));var e=h.style("width").replace("px","");d(100)-d(r.level)-d(r.diff)>e?h.attr("x",d(r.level)+d(r.diff)).attr("dx",4):h.attr("x",d(100)-e).attr("dx",-4)}else if(r.diff<0){var v=d(-r.diff)-d(0);s.attr("x",d(r.level)).style("fill",t.getColor(r.name,60)).transition().delay(300).duration(1e3).attr("x",d(r.level)-v).attr("width",v),p.attr("d",f(r.level,r.level)).transition().delay(300).duration(1e3).attr("d",f(r.level,r.level+r.diff)),h.text(n("round1")(r.diff)),h.attr("x",d(r.level)+d(r.diff)).attr("dx",4)}}}}}]).directive("fix",["$window",function(e){return{restrict:"EA",scope:{},link:function(t,n){var r=d3.select(n[0]),i=d3.select(r[0][0].parentNode);window.onresize=function(){t.$apply()},t.$watch(function(){return angular.element(e)[0].innerWidth},function(){t.render()}),t.render=function(){var e=i[0][0].getBoundingClientRect();console.log(e,window.scrollLeft),r.style({position:"fixed",padding:i.style("padding"),top:window.scrollTop?e.top+window.scrollTop+"px":e.top+"px",left:window.scrollLeft?e.left+window.scrollLeft+"px":e.left+"px",width:e.width+"px"})}}}}]).directive("prog",["$window",function(e){return{restrict:"EA",scope:{complete:"="},link:function(t,n){var r=d3.select(n[0]).append("svg").style("width","100%").style("height",8);window.onresize=function(){t.$apply()},t.$watch(function(){return angular.element(e)[0].innerWidth},function(){t.render()}),t.$watch("complete",function(){t.render()}),t.render=function(){r.selectAll("*").remove();var e=r[0][0].getBoundingClientRect();r.append("rect").attr("height",4).attr("width",e.width*t.complete).attr("fill","#559")}}}}]);
"use strict";angular.module("well.filters",[]).filter("round2",function(){return function(r){return Number(r).toFixed(2)}}).filter("round1",function(){return function(r){return r%1===0?r:Number(r).toFixed(1)}}).filter("percent",function(){return function(r){return d3.format("%")(r)}}).filter("capitalize",function(){return function(r){return r?r.charAt(0).toUpperCase()+r.slice(1):""}});
"use strict";angular.module("well.services",[]).factory("User",["$q","$rootScope","$location","$timeout",function(e,t,i,n){var o=this,s=this;return this.firebase=new Firebase("https://well.firebaseio.com/"),this.info=this.firebase.getAuth(),this.hashedEmail=function(e){return"wiaglif+"+CryptoJS.SHA3(e,{outputLength:224}).toString()+"@gmail.com"},this.signup=function(t,i){var n=e.defer();return o.email=t,o.firebase.createUser({email:t,password:i},function(e){null===e?(console.log("User created successfully"),n.resolve()):(console.log("Error creating user:",e),n.reject(e))}),n.promise},this.login=function(t,i){var r=e.defer();return o.email=t,o.firebase.authWithPassword({email:t,password:i},function(e,t){null===e?(n(function(){s.info=t}),console.log("User ID: "+t.uid+", Provider: "+t.provider),r.resolve(t)):(console.log("Error authenticating user:",e),r.reject(e))}),r.promise},this.firebase.onAuth(function(e){n(function(){t.$broadcast("auth"),s.info=e})}),this.unauth=function(){o.firebase.unauth(),o.info=null},this.setAspects=function(e){o.firebase.onAuth(function(t){t&&s.firebase.child("aspects/"+t.uid).set(e,function(){return s.aspects=e})})},this.getAspects=function(){var t=e.defer();return o.aspects?t.resolve(o.aspects):o.firebase.onAuth(function(e){e&&s.firebase.child("aspects/"+e.uid).on("value",function(e){s.aspects=e.val(),t.resolve(e.val())})}),t.promise},this.test=function(){return"test"},this.addData=function(e,t){console.log(e,t),o.firebase.onAuth(function(i){console.log(i),i&&o.firebase.child("module/"+e+"/"+o.info.uid).push(t)})},this.getData=function(t){var i=e.defer();return o.firebase.onAuth(function(e){e&&o.firebase.child("module/"+t+"/"+o.info.uid).on("value",function(e){return i.resolve(e.val())})}),i.promise},this}]).factory("Aspects",["User","$q","$location",function(e,t,i){this.texts={"Family Well-Being":"the overall well-being of you and your family","Family Happiness":"your and your familyâ€™s happiness",Health:"your health (physical and mental)",Morality:"your morality (that is, living up to your personal values)","Family Relationships":"your family relationships","Financial Security":"your financial security","Options & Possibilities":"your options and possibilities in life","Meaning & Value":"your sense that your life is meaningful and has value","Life Satisfaction":"how satisfied you are with your life","Enough Time & Money":"your feeling that you have enough time and money","Peace, Calm & Harmony":"how peaceful, calm, and harmonious your life is",Independence:"your feeling of independence and self-sufficiency","Making a Difference":"your sense that you are making a difference in the world",Worthwileness:"your feeling that the things you do are worthwhile","Safety & Security":"your physical safety and security",Respect:"your being treated with dignity and respect by others","Amount of Day Happy":"how much of the time you feel happy",Improvement:"your sense that things are getting better and better","Overall Happiness":"how happy you are overall with your life","Life Longevity":"your chance to live a long life"};var n=_.sample(Object.keys(this.texts),5);return this.names=function(){var o=t.defer();return e.getAspects().then(function(t){var s;s=-1!==i.path().split("/")[1].indexOf("overlap")?t.slice(0,3):t,t?o.resolve(s):(e.setAspects(n),o.resolve(s))}),o.promise},this.getColor=function(t,i){if(e.aspects){var n=70*(e.aspects.indexOf(t)+6),o=.99+i/100*-.24;return d3.hsl(n,.8,o).toString()}},this}]).factory("Style",["$window",function(){var e=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}();return function(t,i,n){e.insertRule?e.insertRule(t+"{"+i+"}",n):e.addRule(t,i,n)}}]).factory("Slide",function(){return function(e,t){var i=d3.select(e).style("opacity","0"),n=i.style("width"),o=i.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).style("opacity","1"),s=i.select(function(){return this.parentNode});s.style("pointer-events","none"),o.transition().duration(t).style("left","-"+n).style("opacity","0").each("end",function(){o.remove(),s.style("pointer-events","auto")}),i.transition().duration(t).style("left","-"+n).style("opacity","1").each("end",function(){i.style("left","0px")})}});
"use strict";angular.module("well.survey",[]).controller("ResultsCtrl",["$scope","Aspects","Survey","Choices","User",function(e,s,t,n,r){if(e.weights=n.weights(),e.aspects.sorted=_.sortBy(e.aspects.names,function(s){return-1*e.weights[s]}),e.data=r.getData("threetwo"),!e.weights){e.weights={},_.each(e.aspects.names,function(s){e.weights[s]=Math.random()}),console.log(e.weights);var o=0;_.each(e.aspects.names,function(s){o+=e.weights[s]}),_.each(e.aspects.names,function(s){e.weights[s]=e.weights[s]/o})}}]).controller("SurveyCtrl",["$scope","Aspects","Survey","Style","$location","$routeParams",function(e,s,t,n,r){t.reset(),s.names().then(function(s){e.aspects.names=s,t.aspects=s}),e.survey={finished:!1},e.$watch("responses",function(){t.responded()&&(e.survey.finished=!0)},!0),e.next=function(){switch(r.path().split("/")[1]){case"threetwo":r.path("threetwo/abbcca");break;case"overlap":r.path("overlap/abac");break;case"fineoverlap":r.path("fineoverlap/tradeoff")}}}]).factory("Survey",["Aspects","$q",function(e,s){var t=this,n=this;return this.responses={},this.getResponses=function(){var r=s.defer();return t.aspects?r.resolve(n.responses):e.names().then(function(e){n.aspects=e,_.each(e,function(e){n.responses[e]||(n.responses[e]=null)}),r.resolve(n.responses)}),r.promise},this.respond=function(e,s){return t.responses[e]=s},this.responded=function(){return t.aspects&&_.every(n.aspects,function(e){return n.responses[e]})},this.randomize=function(){console.log("randomized");var r=s.defer();return t.getResponses().then(function(){e.names().then(function(e){for(var s in e)n.responses[e[s]]=Math.max(Math.ceil(99*Math.random()),Math.max(Math.ceil(99*Math.random()),Math.ceil(99*Math.random())));r.resolve(n.responses)})}),r.promise},this.safeRandomize=function(){return t.responded()?t.getResponses():t.randomize()},this.reset=function(){return t.aspects&&_.each(n.aspects,function(e){n.responses[e]=null}),t.responses},this}]);
"use strict";angular.module("well.tradeoff",[]).controller("ThreeCtrl",["$scope","Choices","Tradeoff","Three","Two","Slide","$location","$routeParams","$timeout",function(e,i,o,t,s,n,r){e.choice={},e.choices=i,e.tradeoff=o,e.hidePreamble=function(){o.preamble=!1,setTimeout(function(){t.loadChoice().then(function(i){return e.choice=i})},1)},o.preamble||t.loadChoice().then(function(i){e.choice=i}),e.choose=function(i){e.choice=t.choose(i),n(".options",300)},e.$watch("choice",function(o){e.choices=i,e.completed=i.step++/(t.numberOfQs+s.numberOfQs),o||r.path("threetwo/dbec")})}]).controller("TwoCtrl",["$scope","Choices","Two","Three","Slide","User","$location",function(e,i,o,t,s,n,r){e.choice=!0,e.choices=i,o.loadChoice().then(function(i){e.choice=i}),e.choose=function(i){e.choice=o.choose(i),s(".options",300)},e.$watch("choice",function(s){e.choices=i,e.completed=i.step++/(t.numberOfQs+o.numberOfQs),s||("password"===n.info.provider?(i.submit(),r.path("threetwo/exit")):r.path("threetwo/exit"))})}]).controller("CompleteCtrl",["$scope","User","Choices","$location",function(e,i,o,t){e.login={wrong:!1,placeholder:{email:"Enter your email",password:"Password"},submit:function(){e.login.email?e.login.password?i.login(this.email,this.password).then(function(i){e.login.wrong="in",console.log("Logged in as: ",i.uid),o.submit(),t.path("results")},function(i){e.login.wrong=i.code,"INVALID_EMAIL"===i.code?(e.login.email="",e.login.placeholder.email="Enter a valid email"):"INVALID_PASSWORD"===i.code&&(e.login.password="",e.login.placeholder.password="Enter a valid password"),console.error("Login failed: ",i)}):(e.login.wrong="INVALID_PASSWORD",e.login.placeholder.email="Enter a valid password"):(e.login.wrong="INVALID_EMAIL",e.login.placeholder.email="Enter a valid email")}}}]).factory("Tradeoff",function(){var e={};return e.sign=Math.random()>.5?"positive":"negative",console.log(e.sign),e.preamble=Math.random()>.5,e.positive_tradeoffs=[[4,4],[1,4],[4,1],[1,8],[2,4],[4,2],[8,1],[-4,-3],[-3,-2],[-2,-1],[-1,0],[0,1],[1,2],[2,3],[3,4]],e.negative_tradeoffs=[[-4,-4],[-4,-1],[-1,-4],[-8,-1],[-4,-2],[-2,-4],[-1,-8],[3,4],[2,3],[1,2],[0,1],[-1,0],[-2,-1],[-3,-2],[-4,-3]],e.checkCorners=function(e,i){return e>92&&8>i?"skip":8>e&&i>92?"skip":e>92||i>92?"negative":8>e||8>i?"positive":null},e.values=function(e,i){var o=null===this.checkCorners(e,i)?this.sign:this.checkCorners(e,i);return"positive"===o?this.positive_tradeoffs:"negative"===o?this.negative_tradeoffs:"skip"},e}).factory("Choices",["Aspects","Survey","Tradeoff","User",function(e,i,o,t){var s,n={MRS:{}};return e.names().then(function(e){s=e,_.each(s,function(e){n.MRS[e]={}})}),n.step=0,n.levels=i.responses,n.sign=o.sign,n.skipped=[],n.decisions=[],n.addMRS=function(e,i,o){this.MRS[i][e]=(o[0]+o[1])/2,this.MRS[e][i]=(o[0]+o[1])/-2},n.getMRS=function(e,i){if(i===e)return 0;if(this.MRS[i][e])return this.MRS[i][e];if(Object.keys(this.MRS[i]).length){var o=_.find(Object.keys(n.MRS[i]),function(i){return n.MRS[i][e]});return o?n.MRS[i][o]+n.MRS[o][e]:!1}return!1},n.record=function(e,i){this.decisions.push({aspects:e,i:i,t:Date.now()}),i>6&&this.addMRS(e[1],e[0],o.values(this.levels[e[0]],this.levels[e[1]])[i])},n.weights=function(){var e=0,i=_.map(s,function(i){var o=n.getMRS(i,s[0]);return e+=Math.pow(2,o),Math.pow(2,o)}),o={};return _.each(s,function(t,s){o[t]=i[s]/e}),o},n.submit=function(){t.addData("threetwo",{date:Date.now(),aspects:s,responses:n.levels,decisions:n.decisions,skipped:n.skipped,MRS:n.MRS,weights:n.weights()})},n}]).factory("Three",["Aspects","Survey","Tradeoff","Choices","$q",function(e,i,o,t,s){var n=this,r=this;this.pair=null,this.numberOfQs=9;var a,c;return this.choose=function(e){if(console.log(c),e?t.record(n.pair,e):(e=0,n.pair=n.pairs.shift()),e>6){if(e=0,!n.pairs.length)return!1;n.pair=n.pairs.shift()}var i=o.values(c[n.pair[0]],c[n.pair[1]]);return r.choice={aspects:n.pair,tradeoff:i[e],i:e}},this.loadChoice=function(){var n=s.defer();return e.names().then(function(e){a=e,r.aspects=[a[0],a[1],a[2]],i.safeRandomize().then(function(e){c=e,r.pairs=_.map(r.aspects,function(e,i){return[r.aspects[i],r.aspects[(i+1)%3]]}),r.pairs=_.filter(r.pairs,function(e){var i="skip"===o.values(c[e[0]],c[e[1]]);return i&&t.skipped.push(e),!i}),r.numberOfQs=3*r.pairs.length,console.log(e,c),n.resolve(r.choose(0))})}),n.promise},this}]).factory("Two",["Aspects","Survey","Tradeoff","Choices","Three","$q",function(e,i,o,t,s,n){var r,a,c=this;i.responded()||i.randomize();var h=this;return this.pair=null,this.numberOfQs=6,this.choose=function(e){if(e?t.record(c.pair,e):(e=0,c.pair=c.pairs.shift()),e>6){if(e=0,!c.pairs.length)return!1;c.pair=c.pairs.shift()}var i=o.values(a[c.pair[0]],a[c.pair[1]]);return{aspects:c.pair,tradeoff:i[e],i:e}},this.loadChoice=function(){var c=n.defer();return e.names().then(function(e){r=e,h.aspects=_.difference(r,s.aspects),i.safeRandomize().then(function(e){a=e,h.pairs=[[r[3],r[1]],[r[4],r[2]]],h.pairs=_.filter(h.pairs,function(e){var i="skip"===o.values(a[e[0]],a[e[1]]);return i&&t.skipped.push(e),!i}),h.numberOfQs=3*h.pairs.length,c.resolve(h.choose())})}),c.promise},this}]);
"use strict";angular.module("well.overlap",[]).factory("Overlap",["User","Aspects","Survey",function(e,o,t){var i=this,s=this;return this.doubled=Math.random()>.5,this.preamble=Math.random()>.5,this.decisions=[],this.skipped=[],this.record=function(e){i.decisions.push(e)},this.submit=function(){console.log("submit"),o.names().then(function(o){t.getResponses().then(function(t){console.log(o,t),e.addData("overlap",{date:Date.now(),aspects:o,responses:t,decisions:s.decisions,skipped:s.skipped})})})},s}]).factory("Abc",["Overlap","Choices","Tradeoff","Survey","Aspects","$q",function(e,o,t,i,s,n){var c,a={};return a.MRS={},a.positiveOK=function(e,o,t){return 93>e&&93>o&&93>t},a.negativeOK=function(e,o,t){return e>8&&o>8&&t>8},a.getSign=function(e,o,i){var s=t.sign;return"positive"===s?this.positiveOK(e,o,i)?"positive":this.negativeOK(e,o,i)?"negative":!1:"negative"===s?this.negativeOK(e,o,i)?"negative":this.positiveOK(e,o,i)?"positive":!1:void 0},a.choose=function(o){e.record({aspects:a.aspects,i:o,t:Date.now()});var i=this.getSign(c[a.aspects[0]],c[a.aspects[1]],c[a.aspects[2]]);return!i||o>6||"negative"===i&&3===o&&e.doubled||"positive"===i&&6===o&&e.doubled?!1:"positive"===i?{aspects:this.aspects,tradeoff:t.positive_tradeoffs[o],i:o}:"negative"===i?{aspects:this.aspects,tradeoff:t.negative_tradeoffs[o],i:o}:void 0},a.loadChoice=function(){var e=n.defer();return s.names().then(function(t){a.aspects=[t[0],t[1],t[2]],_.each(a.aspects,function(e){a.MRS[e]={},_.each(a.aspects,function(t){var i=o.getMRS(e,t);a.MRS[e][t]=i?i:0})}),i.safeRandomize().then(function(o){c=o,e.resolve(a.choose(0))})}),e.promise},a}]).factory("Abac",["Aspects","Survey","Overlap","Tradeoff","Choices","$q",function(e,o,t,i,s,n){var c=this,a=this;this.pair=null;var r,h;return o.responded()||o.randomize(),this.choose=function(e){if(t.record({aspects:a.aspects,i:e,t:Date.now()}),e?s.record(c.pair,e):(e=0,c.pair=c.pairs.shift()),e>6){if(e=0,!c.pairs.length)return!1;c.pair=c.pairs.shift()}var o=i.values(h[c.pair[0]],h[c.pair[1]]);return a.choice={aspects:c.pair,tradeoff:o[e],i:e}},this.loadChoice=function(){var s=n.defer();return e.names().then(function(e){r=e,a.aspects=[r[0],r[1],r[2]],o.getResponses().then(function(e){h=e,a.pairs=[[r[0],r[1]],[r[0],r[2]]],a.pairs=_.filter(a.pairs,function(e){var o="skip"===i.values(h[e[0]],h[e[1]]);return o&&t.skipped.push(e),!o}),a.numberOfQs=3*a.pairs.length,s.resolve(a.choose(0))})}),s.promise},this}]).factory("Fine",["Aspects","Survey","Overlap","Abc","$q","User",function(e,o,t,i,s,n){var c=this,a=this;this.tuple=[];var r,h;return this.done={},this.decisions=[],this.positive=null,this.choose=function(e){if(c.decisions.push({tradeoff:c.tradeoff?c.tradeoff:null,choice:e,t:Date.now()}),c.tradeoff&&(c.done[c.tradeoff.toString()]=!0),c.decisions.length>16)return c.submit(),!1;for(;!c.tradeoff||c.done[c.tradeoff.toString()];){var o=_.sample("positive"===c.positive?[[8,8,0],[8,0,8],[8,8,8]]:[[-8,-8,0],[-8,0,-8],[-8,-8,-8]]);console.log(o),c.tradeoff=_.map(o,function(e){return console.log(e),"positive"===c.positive?Math.ceil(Math.random()*e):Math.floor(Math.random()*e)})}return{tradeoff:c.tradeoff}},this.loadChoice=function(){var t=s.defer();return e.names().then(function(e){o.safeRandomize().then(function(o){r=e,h=o,c.positive=i.getSign(h[r[0]],h[r[1]],h[r[2]]),console.log(c.positive),t.resolve(a.choose(0))})}),t.promise},this.submit=function(){console.log("submit"),e.names().then(function(e){o.getResponses().then(function(o){n.addData("fineoverlap",{date:Date.now(),aspects:e,responses:o,decisions:c.decisions})})})},a}]).controller("AbacCtrl",["$scope","Choices","Abac","Slide","$location",function(e,o,t,i,s){e.choice={},e.choices=o,t.loadChoice().then(function(o){e.choice=o}),e.choose=function(o){e.choice=t.choose(o),i(".options",300)},e.$watch("choice",function(t){e.choices=o,e.completed=o.step++/9,t||s.path("overlap/abc")})}]).controller("AbcCtrl",["$scope","Overlap","Abc","$location","Slide","Two","Abac","Choices",function(e,o,t,i,s,n,c,a){e.overlap=o,e.abc=t,e.choice=!0,o.preamble&&t.loadChoice().then(function(o){return e.choice=o}),e.hidePreamble=function(){o.preamble=!0,setTimeout(function(){t.loadChoice().then(function(o){return e.choice=o})},1)},e.choose=function(o){e.choice=t.choose(o),s(".options",300)},e.$watch("choice",function(t){e.choices=a,e.completed=a.step++/9,t||(o.submit(),i.path("overlap/exit"))})}]).controller("FineCtrl",["$scope","Overlap","Fine","$location","Slide","Two","Abac","Choices",function(e,o,t,i,s,n,c,a){e.overlap=o,e.choice=!0,t.loadChoice().then(function(o){e.choice=o}),e.hidePreamble=function(){o.preamble=!0,setTimeout(function(){t.loadChoice().then(function(o){return e.choice=o})},1)},e.choose=function(o){e.choice=t.choose(o),s(".options",300)},e.$watch("choice",function(o){e.choices=a,e.completed=a.step++/12,o||(t.submit(),i.path("fineoverlap/exit"))})}]);
"use strict";angular.module("well.results",[]).directive("sicilian",["$window","Aspects",function(t,e){return{restrict:"EA",scope:{responses:"=",weights:"="},link:function(n,r,i){var a=d3.select(r[0]).append("svg").attr("class","sicilian").style("width","100%");a.style("height",a.style("width")),window.onresize=function(){n.$apply()},n.$watch(function(){return angular.element(t)[0].innerWidth},function(){n.render()}),n.$watch("responses",function(){n.render()},!0),n.$watch("weights",function(){n.render()},!0);var o=null;i.$observe("sort",function(t){o=t});var s=e.names();n.render=function(){var t=_.map(s,function(t){return{name:t,weight:n.weights[t]}});t=_.sortBy(t,function(t){return"level"===o?n.responses[t.name]:-1*t.weight}),a.selectAll("*").remove();var r=a.style("width").replace("px",""),i=a.selectAll().data(t).enter().append("g").style("height",function(t){return t.weight*r});i.append("rect").attr("y",function(e){return _.reduce(t,function(n,i){return t.indexOf(i)>=t.indexOf(e)?n:n+i.weight*r},0)}).attr("width",function(){return r}).attr("height",function(t){return t.weight*r}).style("fill",function(t){return e.getColor(t.name,30)}),i.append("rect").attr("y",function(e){return _.reduce(t,function(n,i){return t.indexOf(i)>=t.indexOf(e)?n:n+i.weight*r},0)}).attr("width",function(t){return n.responses[t.name]/100*r}).attr("height",function(t){return t.weight*r}).style("fill",function(t){return e.getColor(t.name,140)}),i.append("text").attr("class","weight").attr("y",function(e){return e.weight*r*.5+_.reduce(t,function(n,i){return t.indexOf(i)>=t.indexOf(e)?n:n+i.weight*r},0)}).attr("dy",".5em").text(function(t){return d3.format("%")(t.weight)})}}}}]).directive("chart",["$window","User",function(t,e){return{restrict:"EA",scope:{},link:function(n,r){var i=d3.select(r[0]).append("svg");window.onresize=function(){n.$apply()},n.$watch(function(){return angular.element(t)[0].innerWidth},function(){a&&n.render()});var a;e.getData("threetwo").then(function(t){if(a=_.map(t,function(t){var e=_.reduce(t.aspects,function(e,n){return e+t.responses[n]*t.weights[n]},0);return{score:e,date:t.date}}),1===a.length){var e=_.clone(a[0]);e.date=a[0].date-5e4;var r=_.clone(a[0]);r.date=a[0].date+5e4,a=[e,a[0],r]}console.log(a),n.render()}),n.render=function(){console.log(a),i.selectAll("*").remove();var t=r[0].parentNode.getBoundingClientRect();console.log(t);var e=t.width/3,n=t.width;i.attr("width",n).attr("height",e);var o=d3.time.scale().domain([a[0].date,a[a.length-1].date]).rangeRound([30,n-30]),s=d3.scale.linear().domain([0,100]).rangeRound([e-30,30]),c=d3.svg.axis().scale(o).orient("bottom"),l=d3.svg.axis().scale(s).orient("left");i.append("g").attr("class","x axis").attr("transform","translate(0, "+Number(e-30)+")").call(c),i.append("g").attr("class","y axis").attr("transform","translate(30,0)").call(l);var u=d3.svg.line().x(function(t){return o(t.date)}).y(function(t){return s(t.score)}).interpolate("basis");i.append("path").attr("class","line").datum(a).attr("d",u)}}}}]).controller("ExitCtrl",["$scope","User","$location",function(t,e,n){t.satisfaction={level:null,comments:null,submitted:!1,submit:function(){t.satisfaction.submitted=!0,e.addData("feedback",{t:Date.now(),module:n.path().split("/")[1],level:t.satisfaction.level,comments:t.satisfaction.comments})}}}]);
//# sourceMappingURL=maps/all.min.js.map