"use strict";angular.module("well",["ngRoute","well.controllers","well.filters","well.services","well.directives","well.survey","well.tradeoff","well.overlap","well.results"]).config(["$routeProvider","$locationProvider",function(e){e.when("/",{templateUrl:"landing.html"}).when("/auth",{templateUrl:"auth.html"}).when("/consent",{templateUrl:"consent.html"}).when("/terms",{templateUrl:"terms.html"}).when("/privacy",{templateUrl:"privacy.html"}).when("/threetwo/survey",{templateUrl:"survey.html",controller:"SurveyCtrl"}).when("/threetwo/abbcca",{templateUrl:"tradeoff.html",controller:"ThreeCtrl"}).when("/threetwo/dbec",{templateUrl:"tradeoff.html",controller:"TwoCtrl"}).when("/threetwo/exit",{templateUrl:"exit.html",controller:"ExitCtrl"}).when("/overlap/survey",{templateUrl:"survey.html",controller:"SurveyCtrl"}).when("/overlap/transition",{templateUrl:"transition.html",controller:"TransCtrl"}).when("/overlap/abac",{templateUrl:"tradeoff.html",controller:"AbacCtrl"}).when("/overlap/abc",{templateUrl:"overlap.html",controller:"AbcCtrl"}).when("/overlap/exit",{templateUrl:"exit.html",controller:"ExitCtrl"}).when("/fineoverlap/survey",{templateUrl:"survey.html",controller:"SurveyCtrl"}).when("/fineoverlap/tradeoff",{templateUrl:"fineoverlap.html",controller:"FineCtrl"}).when("/fineoverlap/exit",{templateUrl:"exit.html",controller:"ExitCtrl"}).when("/chart",{templateUrl:"chart.html",controller:"ChartCtrl"}).when("/dummy",{templateUrl:"dummy.html",controller:"DummyCtrl"}).when("/test",{templateUrl:"test.html",controller:"TestCtrl"}).otherwise({redirectTo:"/"})}]);
"use strict";angular.module("well.controllers",[]).controller("AppCtrl",["$scope","$rootScope","$timeout","User","$location","Aspects","Survey",function(n,e,o,i,s,l,a){n.aspects={texts:l.texts},e.$on("auth",function(){l.names().then(function(e){return n.aspects.names=e})}),a.getResponses(),n.responses=a.responses,n.user=i,n.settings={devmode:!1,instruct:!0},n.landing={url:"preamble.html"},n.loc=s,n.login={wrong:!1,placeholder:{email:"Enter your email",password:"Password"},submit:function(){n.login.email?n.login.password?i.login(this.email,this.password).then(function(e){n.login.wrong="in",console.log("Logged in as: ",e.uid),n.landing.url="modules.html"},function(e){n.login.wrong=e.code,"INVALID_EMAIL"===e.code?(n.login.email="",n.login.placeholder.email="Enter a valid email"):"INVALID_PASSWORD"===e.code&&(n.login.password="",n.login.placeholder.password="Enter a valid password"),console.error("Login failed: ",e)}):(n.login.wrong="INVALID_PASSWORD",n.login.placeholder.email="Enter a valid password"):(n.login.wrong="INVALID_EMAIL",n.login.placeholder.email="Enter a valid email")}},n.signup={wrong:!1,placeholder:{email:"Enter your email",password:"Password",confirm:"Confirm password"},submit:function(){if(n.signup.email)if(n.signup.password)if(n.signup.password&&n.signup.password&&n.signup.password!==n.signup.confirm)n.signup.wrong="mismatch",n.signup.confirm="";else{i.signup(n.signup.email,n.signup.password).then(function(){o(function(){return n.landing.url="terms.html"})},function(e){console.log(e),n.signup.wrong=e.code,"INVALID_EMAIL"===e.code?(n.signup.email="",n.signup.placeholder.email="Enter a valid email"):"INVALID_PASSWORD"===e.code?(n.signup.password="",n.signup.placeholder.password="Enter a valid password"):"EMAIL_TAKEN"===e.code&&(n.signup.false=!0,alert("The specified email address is already in use.")),console.error("Sign up failed: ",e)})}else n.signup.wrong="INVALID_PASSWORD",n.signup.placeholder.email="Enter a valid password";else n.signup.wrong="INVALID_EMAIL",n.signup.placeholder.email="Enter a valid email"},agree:function(){i.login(n.signup.email,n.signup.password).then(function(e){n.login.wrong="in",console.log("Logged in as: ",e.uid),n.landing.url="modules.html"},function(n){console.log(n)})}},n.cue={option:null}}]).controller("DummyCtrl",["$scope",function(n){var e=["Following your passion","Being acknowledged for your work","Being treated fairly","Having meaningful relationships","Having a sense of purpose"];n.pairs=_.map(e,function(n,o){return[n,e[(o+1)%5]]}),n.levels={},_.each(e,function(e){n.levels[e]=Math.round(35*Math.random()+60)}),n.selections={},console.log(n.pairs,n.levels)}]);
"use strict";angular.module("well.directives",[]).directive("earth",["$window","Aspects",function(t){return{restrict:"EA",scope:{},link:function(e){window.onresize=function(){e.$apply()},e.$watch(function(){return angular.element(t)[0].innerWidth},function(){e.render()});var r=d3.select(".splash");e.render=function(){r.selectAll(".earth *").remove();{var t=window.innerWidth,n=window.innerHeight,a=d3.geo.orthographic().precision(0).scale(500).translate([t/2,n/2]).clipAngle(180),i=d3.select(".splash .earth").append("canvas").attr("width",t).attr("height",n),l=i.node().getContext("2d"),o=d3.geo.path().projection(a).context(l);d3.random.logNormal(1)}_.each(e.responses,function(t){t.rand=20*Math.random()+10}),d3.json("world-110m.json",function(e,r){function i(){a.rotate([.1*c,.1*d,30]),l.clearRect(0,0,t,n),_.each(s,function(t){l.beginPath(),l.strokeStyle=d3.hsl(t.properties.color*c,1,.8).toString(),o(t),l.stroke()})}var c,d=0;window.onscroll=function(){d=(window.pageYOffset||document.scrollTop)-(document.clientTop||0)||0,i()},d3.select("body").on("mousemove",function(){c=d3.mouse(this)[0],i()});var s=(topojson.feature(r,r.objects.land),topojson.feature(r,r.objects.countries).features);_.each(s,function(t){t.properties.color=Math.random()}),i()})}}}}]).directive("range",["$window","$timeout","Aspects",function(t,e){return{restrict:"EA",scope:{level:"="},link:function(r,n){var a=d3.select(n[0]).append("svg").style("width","100%").style("height",22);window.onresize=function(){r.$apply()},r.$watch(function(){return angular.element(t)[0].innerWidth},function(){r.render()});var i=null;r.$watch("level",function(t){t!==i&&r.render()}),r.render=function(){function t(){var t=d.extent()[0],n=c.invert(d3.mouse(this)[0]);t=isNaN(n)?t:n,d.extent([t,t]),t&&(t=Math.round(t)),w.style("display","block").attr("d",h(p().set(c(t)))+"Z"),i=t,e(function(){r.level=t})}a.selectAll("*").remove();var l=d3.select(n[0])[0][0].offsetWidth,o=22,c=d3.scale.linear().domain([0,100]).range([6,l-6]).clamp(!0),d=d3.svg.brush().x(c).extent([r.level,r.level]).on("brush",t),s=a.append("g").attr("class","axis");s.call(d3.svg.axis().scale(c).orient("bottom").tickSize(0).tickValues([]));var f=s.select(".domain").attr("transform","translate(0, 10)");f.select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");var u=a.append("g").attr("class","slider").call(d);u.selectAll(".extent,.resize").remove(),u.select(".background").attr("height",o);var p=function(){var t=c(1),e=10;return{set:function(r){return t=r,[{x:t-6,y:e-6},{x:t+6,y:e-6},{x:t+6,y:e+6},{x:t,y:e+10},{x:t-6,y:e+6}]}}},h=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}),w=u.append("path").attr("class","handle").attr("d",h(p().set(c(r.level)))+"Z").style("display","none")}}}}]).directive("bar",["$window","Aspects","$filter",function(t,e){return{restrict:"E",scope:{level:"=",name:"="},link:function(r,n){var a=d3.select(n[0]).append("svg").attr("width","100%").attr("height",60),i=a.append("g");window.onresize=function(){r.$apply()},r.$watch("level",function(){r.render()}),r.$watch("name",function(){r.render()}),r.$watch(function(){return angular.element(t)[0].innerWidth},function(){r.render()}),r.render=function(){i.selectAll("*").remove();var t=d3.select(n[0])[0][0].offsetWidth,a=t>0?t:100,l=40,o=d3.scale.linear().domain([0,100]).range([6,a-6]),c=i.append("g").attr("class","axis").attr("transform","translate(0,"+(l-20)+")");c.call(d3.svg.axis().scale(o).orient("bottom").tickSize(0).tickPadding(12)),c.select(".domain").remove();var d=(i.append("rect").attr("class","backbar").attr("x",o(0)).attr("y",4).attr("height",20).attr("width",o(100)-o(0)),i.append("rect").attr("class","barBack").attr("x",o(0)).attr("y",4).attr("height",20).attr("width",o(100)-o(0)).style("fill","#eee"),i.append("rect").attr("class","bar").attr("x",o(0)).attr("y",4).attr("height",20).attr("width",o(r.level)-o(0)).style("fill",e.getColor(r.name,100)),i.append("text").attr("class","text").attr("y",14).attr("dy",".375em").style("fill","#000").style("font-weight","400"),o(r.diff?r.level+r.diff:r.level));r.level&&i.append("line").attr("x1",d).attr("y1",4).attr("x2",d).attr("y2",24).style("stroke","#000")}}}}]).directive("diff",["$window","Aspects","$filter","$timeout",function(t,e,r,n){return{restrict:"E",scope:{level:"=",diff:"=",name:"=",choice:"=",animate:"=",option:"@"},link:function(a,i,l){var o,c=i[0].parentNode.getBoundingClientRect().width,d=d3.select(i[0]).append("svg").attr("width",c).attr("height",120),s=d.append("g").attr("transform","translate(0,10)");window.onresize=function(){a.$apply()},a.$watch("level",function(){a.render()}),a.$watch("diff",function(){a.render()}),a.$watch("name",function(){a.render()}),a.$watch("choice",function(){console.log(l.option),"one"===l.option&&(a.animate="one",n(function(){a.animate="two"},2e3)),a.render()},!0),a.$watch("animate",function(){a.animate&&a.animate===l.option&&(a.animate=null,a.render(!0))}),a.$watch(function(){return angular.element(t)[0].innerWidth},function(){a.render()});var f=0,u=0;a.render=function(n){console.log(angular.element(t)[0].innerWidth),c=i[0].parentNode.getBoundingClientRect().width,console.log(c),d.attr("width",c),s.selectAll("*").remove(),o&&o.remove(),c-=30;var l=28,p=d3.scale.linear().domain([0,100]).range([21,c-6]),h=s.append("g").attr("class","axis").attr("transform","translate(0,"+(l+20)+")");h.call(d3.svg.axis().scale(p).orient("bottom").tickSize(0).tickPadding(12)),h.select(".domain").remove();var w=(s.append("rect").attr("class","backbar").attr("x",p(0)).attr("y",l+4).attr("height",20).attr("width",p(100)-p(0)),s.append("rect").attr("class","barBack").attr("x",p(0)).attr("y",l+4).attr("height",20).attr("width",p(100)-p(0)).style("fill","#eee"),s.append("rect").attr("class","bar").attr("x",p(0)).attr("y",l+4).attr("height",20).attr("width",p(a.level)-p(0)).style("fill",e.getColor(a.name,100))),v=(s.append("rect").attr("class","diff").attr("y",l+4).attr("height",20).style("fill",e.getColor(a.name,205)),function(t,e,r){return r+=l,"M"+p(t)+" "+Number(r+2)+" L"+Number(p(e)-4)+" "+Number(r+2)+" L"+Number(p(e)-4)+" "+r+" L"+p(e)+" "+Number(r+3)+" L"+Number(p(e)-4)+" "+Number(r+6)+" L"+Number(p(e)-4)+" "+Number(r+4)+" L"+p(t)+" "+Number(r+4)+" Z"}),m=function(t,e,r){return r+=l,"M"+p(t)+" "+Number(r+2)+" L"+Number(p(e)+4)+" "+Number(r+2)+"L"+Number(p(e)+4)+" "+r+" L"+p(e)+" "+Number(r+3)+" L"+Number(p(e)+4)+" "+Number(r+6)+"L"+Number(p(e)+4)+" "+Number(r+4)+" L"+p(t)+" "+Number(r+4)+" Z"},g=(s.append("path").attr("class","arrow").attr("stroke","none").style("fill","#000"),s.append("text").attr("class","text").attr("y",l+14).attr("dy",".375em").style("fill","#000").style("font-weight","400")),y=p(a.diff?a.level+a.diff:a.level);if(a.level&&s.append("line").attr("x1",y).attr("y1",l+4).attr("x2",y).attr("y2",l+24).style("stroke","#000"),n){if(a.diff){var x=p(8)-p(0);o=d.select(function(){return this.appendChild(this.cloneNode(!0))}).attr("class","zoom");var b="clip"+Math.random().toString().replace(".",""),$=o.append("defs").append("clipPath").attr("id",b);$.append("circle").attr("cx",y).attr("cy",l+24).attr("r",x),o.insert("circle","g").attr("cx",y).attr("cy",l+24).attr("r",x).style("fill","#fff"),o.append("circle").attr("cx",y).attr("cy",l+24).attr("r",x).style("fill","none").style("stroke","#000").style("stroke-width","2px");var N=d[0][0].getBoundingClientRect();o.attr("viewBox",y/2+" "+Number(l/2+10)+" "+N.width/2+" "+N.height/2).attr("clip-path","url(#"+b+")").transition().delay(1300).duration(600).attr("viewBox","0 0 "+N.width+" "+N.height).each("end",function(){return o.remove()}),w.style("fill-opacity","0.6").transition().delay(1300).duration(600).style("fill-opacity","1")}if(a.diff>0){u=a.diff,f=p(a.diff)-p(0),d.selectAll(".diff").attr("x",p(a.level)).attr("width",0).transition().delay(300).duration(1e3).attr("width",f),d.selectAll(".arrow").attr("d",v(a.level,a.level,11)).transition().delay(300).duration(1e3).attr("d",v(a.level,a.level+a.diff,11)),d.selectAll(".text").text("+"+r("round1")(a.diff));{g.style("width").replace("px","")}d.selectAll(".text").attr("text-anchor","start").attr("x",p(a.level+a.diff)).attr("dx",4)}else a.diff<0?(u=a.diff,f=p(-a.diff)-p(0),d.selectAll(".diff").attr("x",p(a.level)).attr("width",0).style("fill",e.getColor(a.name,40)).transition().delay(300).duration(1e3).attr("x",p(a.level)-f).attr("width",f),d.selectAll(".arrow").attr("d",m(a.level,a.level,11)).transition().delay(300).duration(1e3).attr("d",m(a.level,a.level+a.diff,11)),d.selectAll(".text").text(r("round1")(a.diff)),d.selectAll(".text").attr("text-anchor","end").attr("dx",-4).attr("x",p(a.level+a.diff))):u>0?(f=p(u)-p(0),d.selectAll(".diff").attr("x",p(a.level)).attr("width",f).transition().duration(1e3).attr("width",0)):0>u&&(f=p(-u)-p(0),d.selectAll(".diff").attr("x",p(a.level)-f).attr("width",f).style("fill",e.getColor(a.name,40)).transition().delay(300).duration(1e3).attr("x",p(a.level)).attr("width",0))}}}}}]).directive("fix",["$window",function(t){return{restrict:"EA",scope:{},link:function(e,r){var n=d3.select(r[0]),a=d3.select(n[0][0].parentNode);window.onresize=function(){e.$apply()},e.$watch(function(){return angular.element(t)[0].innerWidth},function(){e.render()}),e.render=function(){var t=a[0][0].getBoundingClientRect();console.log(t,window.scrollLeft),n.style({position:"fixed",padding:a.style("padding"),top:window.scrollTop?t.top+window.scrollTop+"px":t.top+"px",left:window.scrollLeft?t.left+window.scrollLeft+"px":t.left+"px",width:t.width+"px"})}}}}]).directive("prog",["$window",function(t){return{restrict:"EA",scope:{complete:"="},link:function(e,r){var n=d3.select(r[0]).append("svg").style("width","100%").style("height",8);window.onresize=function(){e.$apply()},e.$watch(function(){return angular.element(t)[0].innerWidth},function(){e.render()}),e.$watch("complete",function(){e.render()}),e.render=function(){n.selectAll("*").remove();var t=n[0][0].getBoundingClientRect();n.append("rect").attr("height",4).attr("width",t.width*e.complete).attr("fill","#559")}}}}]).directive("back",["Aspects",function(t){return{restrict:"EA",scope:{name:"="},link:function(e,r){e.$watch("name",function(e){r[0].style.border="1px solid "+t.getColor(e,60)})}}}]);
"use strict";angular.module("well.filters",[]).filter("round2",function(){return function(r){return Number(r).toFixed(2)}}).filter("round1",function(){return function(r){return r%1===0?r:Number(r).toFixed(1)}}).filter("percent",function(){return function(r){return d3.format("%")(r)}}).filter("capitalize",function(){return function(r){return r?r.charAt(0).toUpperCase()+r.slice(1):""}});
"use strict";angular.module("well.services",[]).factory("User",["$q","$rootScope","$location","$timeout",function(e,t,i,n){var o=this,s=this;return this.firebase=new Firebase("https://well.firebaseio.com/"),this.info=this.firebase.getAuth(),this.hashedEmail=function(e){return"wiaglif+"+CryptoJS.SHA3(e,{outputLength:224}).toString()+"@gmail.com"},this.signup=function(t,i){var n=e.defer();return o.email=t,o.firebase.createUser({email:t,password:i},function(e){null===e?(console.log("User created successfully"),n.resolve()):(console.log("Error creating user:",e),n.reject(e))}),n.promise},this.login=function(t,i){var r=e.defer();return o.email=t,o.firebase.authWithPassword({email:t,password:i},function(e,t){null===e?(n(function(){s.info=t}),console.log("User ID: "+t.uid+", Provider: "+t.provider),r.resolve(t)):(console.log("Error authenticating user:",e),r.reject(e))}),r.promise},this.firebase.onAuth(function(e){n(function(){t.$broadcast("auth"),s.info=e})}),this.unauth=function(){o.firebase.unauth(),o.info=null},this.setAspects=function(e){o.firebase.onAuth(function(t){t&&s.firebase.child("aspects/"+t.uid).set(e,function(){return s.aspects=e})})},this.getAspects=function(){var t=e.defer();return o.aspects?t.resolve(o.aspects):o.firebase.onAuth(function(e){e&&s.firebase.child("aspects/"+e.uid).on("value",function(e){s.aspects=e.val(),t.resolve(e.val())})}),t.promise},this.test=function(){return"test"},this.addData=function(e,t){console.log(e,t),o.firebase.onAuth(function(i){console.log(i),i&&o.firebase.child("module/"+e+"/"+o.info.uid).push(t)})},this.getData=function(t){var i=e.defer();return o.firebase.onAuth(function(e){e&&o.firebase.child("module/"+t+"/"+o.info.uid).on("value",function(e){return i.resolve(e.val())})}),i.promise},this}]).factory("Aspects",["User","$q","$location",function(e,t,i){this.texts={"Family Well-Being":"the overall well-being of you and your family","Family Happiness":"your and your familyâ€™s happiness",Health:"your health (physical and mental)",Morality:"your morality (that is, living up to your personal values)","Family Relationships":"your family relationships","Financial Security":"your financial security","Options & Possibilities":"your options and possibilities in life","Meaning & Value":"your sense that your life is meaningful and has value","Life Satisfaction":"how satisfied you are with your life","Enough Time & Money":"your feeling that you have enough time and money","Peace, Calm & Harmony":"how peaceful, calm, and harmonious your life is",Independence:"your feeling of independence and self-sufficiency","Making a Difference":"your sense that you are making a difference in the world",Worthwileness:"your feeling that the things you do are worthwhile","Safety & Security":"your physical safety and security",Respect:"your being treated with dignity and respect by others","Amount of Day Happy":"how much of the time you feel happy",Improvement:"your sense that things are getting better and better","Overall Happiness":"how happy you are overall with your life","Life Longevity":"your chance to live a long life"};var n=_.sample(Object.keys(this.texts),5);return this.names=function(){var o=t.defer();return e.getAspects().then(function(t){var s;s=-1!==i.path().split("/")[1].indexOf("overlap")?t.slice(0,3):t,t?o.resolve(s):(e.setAspects(n),o.resolve(s))}),o.promise},this.getColor=function(t,i){if(e.aspects){var n=70*(e.aspects.indexOf(t)+6),o=.99+i/100*-.24;return d3.hsl(n,.8,o).toString()}},this}]).factory("Style",["$window",function(){var e=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}();return function(t,i,n){e.insertRule?e.insertRule(t+"{"+i+"}",n):e.addRule(t,i,n)}}]).factory("Slide",function(){return function(e,t){var i=d3.select(e).style("opacity","0"),n=i.style("width"),o=i.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).style("opacity","1"),s=i.select(function(){return this.parentNode});s.style("pointer-events","none"),o.transition().duration(t).style("left","-"+n).style("opacity","0").each("end",function(){o.remove(),s.style("pointer-events","auto")}),i.transition().duration(t).style("left","-"+n).style("opacity","1").each("end",function(){i.style("left","0px")})}});
"use strict";angular.module("well.survey",[]).controller("ResultsCtrl",["$scope","Aspects","Survey","Choices","User",function(e,s,t,n,r){if(e.weights=n.weights(),e.aspects.sorted=_.sortBy(e.aspects.names,function(s){return-1*e.weights[s]}),e.data=r.getData("threetwo"),!e.weights){e.weights={},_.each(e.aspects.names,function(s){e.weights[s]=Math.random()}),console.log(e.weights);var o=0;_.each(e.aspects.names,function(s){o+=e.weights[s]}),_.each(e.aspects.names,function(s){e.weights[s]=e.weights[s]/o})}}]).controller("SurveyCtrl",["$scope","Aspects","Survey","Style","$location","$routeParams","Trans",function(e,s,t,n,r){t.reset(),s.names().then(function(s){e.aspects.names=s,t.aspects=s}),e.survey={finished:!1},e.$watch("responses",function(){t.responded()&&(e.survey.finished=!0)},!0),e.next=function(){switch(r.path().split("/")[1]){case"threetwo":r.path("threetwo/abbcca");break;case"overlap":r.path("overlap/abac");break;case"fineoverlap":r.path("fineoverlap/tradeoff")}}}]).controller("TransCtrl",["$scope","Aspects","Survey","Style","$location","$routeParams",function(e,s,t){s.names().then(function(s){e.aspects.names=s,t.aspects=s})}]).factory("Survey",["Aspects","$q",function(e,s){var t=this,n=this;return this.responses={},this.getResponses=function(){var r=s.defer();return t.aspects?r.resolve(n.responses):e.names().then(function(e){n.aspects=e,_.each(e,function(e){n.responses[e]||(n.responses[e]=null)}),r.resolve(n.responses)}),r.promise},this.respond=function(e,s){return t.responses[e]=s},this.responded=function(){return t.aspects&&_.every(n.aspects,function(e){return n.responses[e]})},this.randomize=function(){console.log("randomized");var r=s.defer();return t.getResponses().then(function(){e.names().then(function(e){for(var s in e)n.responses[e[s]]=Math.max(Math.ceil(99*Math.random()),Math.max(Math.ceil(99*Math.random()),Math.ceil(99*Math.random())));r.resolve(n.responses)})}),r.promise},this.safeRandomize=function(){return t.responded()?t.getResponses():t.randomize()},this.reset=function(){return t.aspects&&_.each(n.aspects,function(e){n.responses[e]=null}),t.responses},this}]).factory("Trans",function(){var e=this;return this.ition=function(){d3.selectAll(".slide range").style("opacity",1).transition().duration(300).style("opacity",0).each("end",function(){d3.selectAll(".slide range").remove()}),d3.select(".panel").remove();var e=d3.select("ul.survey");e.style("width","100%").transition().delay(300).duration(1e3).style("width","50%").each("end",function(){var s=e.select(function(){return this.parentNode.appendChild(this.cloneNode(!0))});s.style("opacity",0).transition().duration(500).style("opacity",1)})},e});
"use strict";angular.module("well.tradeoff",[]).controller("ThreeCtrl",["$scope","Choices","Tradeoff","Three","Two","Slide","$location","$routeParams","$timeout",function(e,o,i,t,n,s,r){e.choice={},e.choices=o,e.tradeoff=i,e.hidePreamble=function(){i.preamble=!1,setTimeout(function(){t.loadChoice().then(function(o){return e.choice=o})},1)},i.preamble||t.loadChoice().then(function(o){e.choice=o}),e.choose=function(o){e.choice=t.choose(o),s(".options",300),e.animate=Math.random()},e.$watch("choice",function(i){e.choices=o,e.completed=o.step++/(t.numberOfQs+n.numberOfQs),i||r.path("threetwo/dbec")})}]).controller("TwoCtrl",["$scope","Choices","Two","Three","Slide","User","$location",function(e,o,i,t,n,s,r){e.choice=!0,e.choices=o,i.loadChoice().then(function(o){e.choice=o}),e.choose=function(o){e.choice=i.choose(o),n(".options",300)},e.$watch("choice",function(n){e.choices=o,e.completed=o.step++/(t.numberOfQs+i.numberOfQs),n||("password"===s.info.provider?(o.submit(),r.path("threetwo/exit")):r.path("threetwo/exit"))})}]).controller("TestCtrl",["$scope","Choices","Two","Three","Slide","User","$location",function(e,o,i,t,n,s,r){e.choice=!0,e.choices=o,e.options={one:0,two:0,choice:null,highlight:function(o){e.options.choice||(1===o?(e.options.one=e.choice.tradeoff[0],e.options.two=0):(e.options.two=e.choice.tradeoff[1],e.options.one=0))},select:function(o){e.options.choice=o,1===o?(e.options.one=e.choice.tradeoff[0],e.options.two=0):(e.options.two=e.choice.tradeoff[1],e.options.one=0)},reset:function(){e.options.choice||(e.options.one=e.options.two=0)}},i.loadChoice().then(function(o){e.choice=o}),e.choose=function(){var o=e.options.one?2*e.choice.i+1:2*e.choice.i+2;e.choice=i.choose(o),e.options.choice=null,e.options.reset(),n(".scenario",300)},e.$watch("choice",function(t){e.choices=o,e.completed=o.step++/i.numberOfQs,t||r.path("threetwo/exit")})}]).controller("CompleteCtrl",["$scope","User","Choices","$location",function(e,o,i,t){e.login={wrong:!1,placeholder:{email:"Enter your email",password:"Password"},submit:function(){e.login.email?e.login.password?o.login(this.email,this.password).then(function(o){e.login.wrong="in",console.log("Logged in as: ",o.uid),i.submit(),t.path("results")},function(o){e.login.wrong=o.code,"INVALID_EMAIL"===o.code?(e.login.email="",e.login.placeholder.email="Enter a valid email"):"INVALID_PASSWORD"===o.code&&(e.login.password="",e.login.placeholder.password="Enter a valid password"),console.error("Login failed: ",o)}):(e.login.wrong="INVALID_PASSWORD",e.login.placeholder.email="Enter a valid password"):(e.login.wrong="INVALID_EMAIL",e.login.placeholder.email="Enter a valid email")}}}]).factory("Tradeoff",function(){var e={};return e.sign=Math.random()>.5?"positive":"negative",console.log(e.sign),e.preamble=Math.random()>.5,e.positive_tradeoffs=[[4,4],[1,4],[4,1],[1,8],[2,4],[4,2],[8,1],[-4,-3],[-3,-2],[-2,-1],[-1,0],[0,1],[1,2],[2,3],[3,4]],e.negative_tradeoffs=[[-4,-4],[-4,-1],[-1,-4],[-8,-1],[-4,-2],[-2,-4],[-1,-8],[3,4],[2,3],[1,2],[0,1],[-1,0],[-2,-1],[-3,-2],[-4,-3]],e.checkCorners=function(e,o){return e>92&&8>o?"skip":8>e&&o>92?"skip":e>92||o>92?"negative":8>e||8>o?"positive":null},e.values=function(e,o){var i=null===this.checkCorners(e,o)?this.sign:this.checkCorners(e,o);return"positive"===i?this.positive_tradeoffs:"negative"===i?this.negative_tradeoffs:"skip"},e}).factory("Choices",["Aspects","Survey","Tradeoff","User",function(e,o,i,t){var n,s={MRS:{}};return e.names().then(function(e){n=e,_.each(n,function(e){s.MRS[e]={}})}),s.step=0,s.levels=o.responses,s.sign=i.sign,s.skipped=[],s.decisions=[],s.addMRS=function(e,o,i){this.MRS[o][e]=(i[0]+i[1])/2,this.MRS[e][o]=(i[0]+i[1])/-2},s.getMRS=function(e,o){if(o===e)return 0;if(this.MRS[o][e])return this.MRS[o][e];if(Object.keys(this.MRS[o]).length){var i=_.find(Object.keys(s.MRS[o]),function(o){return s.MRS[o][e]});return i?s.MRS[o][i]+s.MRS[i][e]:!1}return!1},s.record=function(e,o){this.decisions.push({aspects:e,i:o,t:Date.now()}),o>6&&this.addMRS(e[1],e[0],i.values(this.levels[e[0]],this.levels[e[1]])[o])},s.weights=function(){var e=0,o=_.map(n,function(o){var i=s.getMRS(o,n[0]);return e+=Math.pow(2,i),Math.pow(2,i)}),i={};return _.each(n,function(t,n){i[t]=o[n]/e}),i},s.submit=function(){t.addData("threetwo",{date:Date.now(),aspects:n,responses:s.levels,decisions:s.decisions,skipped:s.skipped,MRS:s.MRS,weights:s.weights()})},s}]).factory("Three",["Aspects","Survey","Tradeoff","Choices","$q",function(e,o,i,t,n){var s=this,r=this;this.pair=null,this.numberOfQs=9;var c,a;return this.choose=function(e){if(console.log(a),e?t.record(s.pair,e):(e=0,s.pair=s.pairs.shift()),e>6){if(e=0,!s.pairs.length)return!1;s.pair=s.pairs.shift()}var o=i.values(a[s.pair[0]],a[s.pair[1]]);return r.choice={aspects:s.pair,tradeoff:o[e],i:e}},this.loadChoice=function(){var s=n.defer();return e.names().then(function(e){c=e,r.aspects=[c[0],c[1],c[2]],o.safeRandomize().then(function(e){a=e,r.pairs=_.map(r.aspects,function(e,o){return[r.aspects[o],r.aspects[(o+1)%3]]}),r.pairs=_.filter(r.pairs,function(e){var o="skip"===i.values(a[e[0]],a[e[1]]);return o&&t.skipped.push(e),!o}),r.numberOfQs=3*r.pairs.length,console.log(e,a),s.resolve(r.choose(0))})}),s.promise},this}]).factory("Two",["Aspects","Survey","Tradeoff","Choices","Three","$q",function(e,o,i,t,n,s){var r,c,a=this;o.responded()||o.randomize();var h=this;return this.pair=null,this.numberOfQs=6,this.choose=function(e){if(e?t.record(a.pair,e):(e=0,a.pair=a.pairs.shift()),e>6){if(e=0,!a.pairs.length)return!1;a.pair=a.pairs.shift()}var o=i.values(c[a.pair[0]],c[a.pair[1]]);return{aspects:a.pair,tradeoff:o[e],i:e}},this.loadChoice=function(){var a=s.defer();return e.names().then(function(e){r=e,h.aspects=_.difference(r,n.aspects),o.safeRandomize().then(function(e){c=e,h.pairs=[[r[3],r[1]],[r[4],r[2]]],h.pairs=_.filter(h.pairs,function(e){var o="skip"===i.values(c[e[0]],c[e[1]]);return o&&t.skipped.push(e),!o}),h.numberOfQs=3*h.pairs.length,a.resolve(h.choose())})}),a.promise},this}]);
"use strict";angular.module("well.overlap",[]).factory("Overlap",["User","Aspects","Survey",function(e,o,t){var i=this,s=this;return this.doubled=Math.random()>.5,this.preamble=Math.random()>.5,this.decisions=[],this.skipped=[],this.record=function(e){i.decisions.push(e)},this.submit=function(){console.log("submit"),o.names().then(function(o){t.getResponses().then(function(t){console.log(o,t),e.addData("overlap",{date:Date.now(),aspects:o,responses:t,decisions:s.decisions,skipped:s.skipped})})})},s}]).factory("Abc",["Overlap","Choices","Tradeoff","Survey","Aspects","$q",function(e,o,t,i,s,n){var c,a={};return a.MRS={},a.positiveOK=function(e,o,t){return 93>e&&93>o&&93>t},a.negativeOK=function(e,o,t){return e>8&&o>8&&t>8},a.getSign=function(e,o,i){var s=t.sign;return"positive"===s?this.positiveOK(e,o,i)?"positive":this.negativeOK(e,o,i)?"negative":!1:"negative"===s?this.negativeOK(e,o,i)?"negative":this.positiveOK(e,o,i)?"positive":!1:void 0},a.choose=function(o){e.record({aspects:a.aspects,i:o,t:Date.now()});var i=this.getSign(c[a.aspects[0]],c[a.aspects[1]],c[a.aspects[2]]);return!i||o>6||"negative"===i&&3===o&&e.doubled||"positive"===i&&6===o&&e.doubled?!1:"positive"===i?{aspects:this.aspects,tradeoff:t.positive_tradeoffs[o],i:o}:"negative"===i?{aspects:this.aspects,tradeoff:t.negative_tradeoffs[o],i:o}:void 0},a.loadChoice=function(){var e=n.defer();return s.names().then(function(t){a.aspects=[t[0],t[1],t[2]],_.each(a.aspects,function(e){a.MRS[e]={},_.each(a.aspects,function(t){var i=o.getMRS(e,t);a.MRS[e][t]=i?i:0})}),i.safeRandomize().then(function(o){c=o,e.resolve(a.choose(0))})}),e.promise},a}]).factory("Abac",["Aspects","Survey","Overlap","Tradeoff","Choices","$q",function(e,o,t,i,s,n){var c=this,a=this;this.pair=null;var r,h;return o.responded()||o.randomize(),this.choose=function(e){if(t.record({aspects:a.aspects,i:e,t:Date.now()}),e?s.record(c.pair,e):(e=0,c.pair=c.pairs.shift()),e>6){if(e=0,!c.pairs.length)return!1;c.pair=c.pairs.shift()}var o=i.values(h[c.pair[0]],h[c.pair[1]]);return a.choice={aspects:c.pair,tradeoff:o[e],i:e}},this.loadChoice=function(){var s=n.defer();return e.names().then(function(e){r=e,a.aspects=[r[0],r[1],r[2]],o.getResponses().then(function(e){h=e,a.pairs=[[r[0],r[1]],[r[0],r[2]]],a.pairs=_.filter(a.pairs,function(e){var o="skip"===i.values(h[e[0]],h[e[1]]);return o&&t.skipped.push(e),!o}),a.numberOfQs=3*a.pairs.length,s.resolve(a.choose(0))})}),s.promise},this}]).factory("Fine",["Aspects","Survey","Overlap","Abc","$q","User",function(e,o,t,i,s,n){var c=this,a=this;this.tuple=[];var r,h;return this.done={},this.decisions=[],this.positive=null,this.choose=function(e){if(c.decisions.push({tradeoff:c.tradeoff?c.tradeoff:null,choice:e,t:Date.now()}),c.tradeoff&&(c.done[c.tradeoff.toString()]=!0),c.decisions.length>16)return c.submit(),!1;for(;!c.tradeoff||c.done[c.tradeoff.toString()];){var o=_.sample("positive"===c.positive?[[8,8,0],[8,0,8],[8,8,8]]:[[-8,-8,0],[-8,0,-8],[-8,-8,-8]]);console.log(o),c.tradeoff=_.map(o,function(e){return console.log(e),"positive"===c.positive?Math.ceil(Math.random()*e):Math.floor(Math.random()*e)})}return{tradeoff:c.tradeoff}},this.loadChoice=function(){var t=s.defer();return e.names().then(function(e){o.safeRandomize().then(function(o){r=e,h=o,c.positive=i.getSign(h[r[0]],h[r[1]],h[r[2]]),console.log(c.positive),t.resolve(a.choose(0))})}),t.promise},this.submit=function(){console.log("submit"),e.names().then(function(e){o.getResponses().then(function(o){n.addData("fineoverlap",{date:Date.now(),aspects:e,responses:o,decisions:c.decisions})})})},a}]).controller("AbacCtrl",["$scope","Choices","Abac","Slide","$location",function(e,o,t,i,s){e.choice={},e.choices=o,t.loadChoice().then(function(o){e.choice=o}),e.choose=function(o){e.choice=t.choose(o),i(".options",300)},e.$watch("choice",function(t){e.choices=o,e.completed=o.step++/9,t||s.path("overlap/abc")})}]).controller("AbcCtrl",["$scope","Overlap","Abc","$location","Slide","Two","Abac","Choices",function(e,o,t,i,s,n,c,a){e.overlap=o,e.abc=t,e.choice=!0,o.preamble&&t.loadChoice().then(function(o){return e.choice=o}),e.hidePreamble=function(){o.preamble=!0,setTimeout(function(){t.loadChoice().then(function(o){return e.choice=o})},1)},e.choose=function(o){e.choice=t.choose(o),s(".options",300)},e.$watch("choice",function(t){e.choices=a,e.completed=a.step++/9,t||(o.submit(),i.path("overlap/exit"))})}]).controller("FineCtrl",["$scope","Overlap","Fine","$location","Slide","Two","Abac","Choices",function(e,o,t,i,s,n,c,a){e.overlap=o,e.choice=!0,t.loadChoice().then(function(o){e.choice=o}),e.hidePreamble=function(){o.preamble=!0,setTimeout(function(){t.loadChoice().then(function(o){return e.choice=o})},1)},e.choose=function(o){e.choice=t.choose(o),s(".options",300)},e.$watch("choice",function(o){e.choices=a,e.completed=a.step++/12,o||(t.submit(),i.path("fineoverlap/exit"))})}]);
"use strict";angular.module("well.results",[]).directive("sicilian",["$window","Aspects",function(t,e){return{restrict:"EA",scope:{responses:"=",weights:"="},link:function(n,r,i){var a=d3.select(r[0]).append("svg").attr("class","sicilian").style("width","100%");a.style("height",a.style("width")),window.onresize=function(){n.$apply()},n.$watch(function(){return angular.element(t)[0].innerWidth},function(){n.render()}),n.$watch("responses",function(){n.render()},!0),n.$watch("weights",function(){n.render()},!0);var o=null;i.$observe("sort",function(t){o=t});var s=e.names();n.render=function(){var t=_.map(s,function(t){return{name:t,weight:n.weights[t]}});t=_.sortBy(t,function(t){return"level"===o?n.responses[t.name]:-1*t.weight}),a.selectAll("*").remove();var r=a.style("width").replace("px",""),i=a.selectAll().data(t).enter().append("g").style("height",function(t){return t.weight*r});i.append("rect").attr("y",function(e){return _.reduce(t,function(n,i){return t.indexOf(i)>=t.indexOf(e)?n:n+i.weight*r},0)}).attr("width",function(){return r}).attr("height",function(t){return t.weight*r}).style("fill",function(t){return e.getColor(t.name,30)}),i.append("rect").attr("y",function(e){return _.reduce(t,function(n,i){return t.indexOf(i)>=t.indexOf(e)?n:n+i.weight*r},0)}).attr("width",function(t){return n.responses[t.name]/100*r}).attr("height",function(t){return t.weight*r}).style("fill",function(t){return e.getColor(t.name,140)}),i.append("text").attr("class","weight").attr("y",function(e){return e.weight*r*.5+_.reduce(t,function(n,i){return t.indexOf(i)>=t.indexOf(e)?n:n+i.weight*r},0)}).attr("dy",".5em").text(function(t){return d3.format("%")(t.weight)})}}}}]).directive("chart",["$window","User",function(t,e){return{restrict:"EA",scope:{},link:function(n,r){var i=d3.select(r[0]).append("svg");window.onresize=function(){n.$apply()},n.$watch(function(){return angular.element(t)[0].innerWidth},function(){a&&n.render()});var a;e.getData("threetwo").then(function(t){if(a=_.map(t,function(t){var e=_.reduce(t.aspects,function(e,n){return e+t.responses[n]*t.weights[n]},0);return{score:e,date:t.date}}),1===a.length){var e=_.clone(a[0]);e.date=a[0].date-5e4;var r=_.clone(a[0]);r.date=a[0].date+5e4,a=[e,a[0],r]}console.log(a),n.render()}),n.render=function(){console.log(a),i.selectAll("*").remove();var t=r[0].parentNode.getBoundingClientRect();console.log(t);var e=t.width/3,n=t.width;i.attr("width",n).attr("height",e);var o=d3.time.scale().domain([a[0].date,a[a.length-1].date]).rangeRound([30,n-30]),s=d3.scale.linear().domain([0,100]).rangeRound([e-30,30]),c=d3.svg.axis().scale(o).orient("bottom"),l=d3.svg.axis().scale(s).orient("left");i.append("g").attr("class","x axis").attr("transform","translate(0, "+Number(e-30)+")").call(c),i.append("g").attr("class","y axis").attr("transform","translate(30,0)").call(l);var u=d3.svg.line().x(function(t){return o(t.date)}).y(function(t){return s(t.score)}).interpolate("basis");i.append("path").attr("class","line").datum(a).attr("d",u)}}}}]).controller("ExitCtrl",["$scope","User","$location",function(t,e,n){t.satisfaction={level:null,comments:null,submitted:!1,submit:function(){t.satisfaction.submitted=!0,e.addData("feedback",{t:Date.now(),module:n.path().split("/")[1],level:t.satisfaction.level,comments:t.satisfaction.comments})}}}]);
//# sourceMappingURL=maps/all.min.js.map